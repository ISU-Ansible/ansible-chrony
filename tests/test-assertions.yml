---
- hosts: localhost
  remote_user: root

  roles:
    - role_under_test

  tasks:
    - name: "[Test] Does Configuration File Exist?"
      stat:
        path: "{{ chrony_configuration_file }}"
      register: chrony_conf

    - name: "[Test] Test File Defaults"
      shell: "grep 'driftfile.*/var/lib/chrony/drift' {{ chrony_configuration_file }}"
      when: chrony_conf.stat.exists == True
      register: chrony_conf_contents

    - name: "[Test] Absense of 'noclientlog'"
      shell: "grep 'noclientlog' {{ chrony_configuration_file }}"
      when: chrony_conf.stat.exists == True
      register: noclientlog_stat
      ignore_errors: true

    - name: "[Test] Checking configuration file"
      shell: "cat {{ chrony_configuration_file }}"
      register: stuff

    - debug:
        var: noclientlog_stat

    - debug:
        var: stuff

    - assert:
        that:
          - "chrony_conf_contents.rc == 0"
          - "noclientlog_stat.rc != 0"
